---
title: Linux命令
tags: Utilities
article_header:
  type: 
  image:
    src: 
---

Linux常用命令速查。

<!--more-->

## 文件及目录管理


### 文件的创建和删除


- 创建：mkdir
- 删除：rm
- 删除非空目录：rm -rf file目录
- 删除日志 rm * log (等价: $find ./ -name “*log” -exec rm {} ;)
- 移动：mv
- 复制：cp (复制目录：cp -r source_dir dest_dir)



### 目录切换


- 找到文件/目录位置：cd
- 切换到上一个工作目录： cd -
- 切换到home目录： cd or cd ~
- 显示当前路径: pwd
- 更改当前工作路径为path: $cd path



### 列出目录项

- 显示当前目录下的文件 ls (可以用`ls | cat -n`给每个文件添加id编号)
- 按时间排序，以列表的方式显示目录项 `ls -lrt`
- 查看当前目录下文件个数：`find ./ | wc -l`



### 查找目录及文件

- 用find进行实时查找：搜寻文件或目录

```bash
find ./ -name "core*"
find ./ -name '*.o'

find ./ -name "*.o" -exec rm {} \
```

- 查找txt和pdf文件：

```bash
find . \( -name "*.txt" -o -name "*.pdf" \) -print

find . -regex  ".*\(\.txt|\.pdf\)$" // 正则写法
```


- 只列出所有目录：

```bash
find . -type d -print  (-type f 文件 / l 符号链接 / d 目录)
```


- 用locate为文件系统建立索引数据库，定期执行更新命令更新索引库

```bash
locate [filename]

updatedb
```


### 查看文件内容


- 只看前10行

```bash
head -n 10 [filename]
```


- 只看倒数5行

```bash
tail -n 5 [filename]
```


- 查看两个文件之间的差别

```bash
diff file1 file2
```


### 文件与目录权限修改


- 改变文件拥有者：chown
   - 递归子目录修改：chown -R owner source/
- 改变文件读、写、执行属性：chmod
增加脚本可执行权限：chmod a+x myscript



### 给文件增加别名


创建符号链接/硬链接:


```bash
ln cc ccAgain :硬连接；删除一个，将仍能找到；
ln -s cc ccTo :符号链接(软链接)；删除源，另一个无法使用；（后面一个ccTo 为新建的文件）
```


### 管道和重定向


- 批处理命令连接执行，使用 `|`
- 串联: 使用分号 `;`
- 前面成功，则执行后面一条，否则，不执行: `&&`
- 前面失败，则后一条执行: `||`



```bash
ls /proc && echo  suss! || echo failed.
```


重定向：


```bash
ls  proc/*.c > list 2> &l 将标准输出和标准错误重定向到同一文件；
```


## 文本处理


### 查找文件内容


使用egrep查找文件内容：


```bash
egrep '03.1\/CO\/AE' TSF_STAT_111130.log.012
egrep 'A_LMCA777:C' TSF_STAT_111130.log.035 > co.out2
```


grep文本搜索：


```bash
grep match_pattern file

grep "class" . -R -n // 多级目录中对文本递归搜索
grep -e "class" -e "vitural" file // 匹配多个模式
```


grep常用参数：


- -o 只输出匹配的文本行 VS -v 只输出没有匹配的文本行
- -c 统计文件中包含文本的次数
   - grep -c “text” filename
- -n 打印匹配的行号
- -i 搜索时忽略大小写
- -l 只打印文件名



### xargs命令行参数转换


xargs能够将输入数据转化为特定命令的命令行参数。参数说明：


- -d 定义定界符 （默认为空格 多行的定界符为 n）
- -n 指定输出为多行
- -I {} 指定替换字符串，这个字符串在xargs扩展时会被替换掉,用于待执行的命令需要多个参数时
- -0：指定0为输入定界符



```bash
# 单行转多行输出
cat single.txt | xargs -n 3

cat file.txt | xargs -I {} ./command.sh -p {} -1

#统计程序行数
find source_dir/ -type f -name "*.cpp" -print0 |xargs -0 wc -l
```


### sort排序


参数说明：


- -n 按数字进行排序
- -d 按字典序进行排序
- -r 逆序排序
- -k N 指定按第N列排序



```bash
sort -nrk 1 data.txt
sort -bd data // 忽略像空格之类的前导空白字符
```


### uniq消除重复行


```bash
sort unsort.txt | uniq // 消除重复
uniq -c // 各行在文件中出现的次数
uniq -d // 找出重复行
uniq -i // 忽视大小写并消除重复
```


### 用tr进行转换


tr中可用各种字符类：


- alnum：字母和数字
- alpha：字母
- digit：数字
- space：空白字符
- lower：小写
- upper：大写
- cntrl：控制（非可打印）字符
- print：可打印字符



使用方法：


```bash
tr '[:class:]' '[:class:]'
```


```bash
echo 12345 | tr '0-9' '9876543210' //加解密转换，替换对应字符
cat text| tr '\t' ' '  //制表符转空格

cat file | tr -d '0-9' // 删除所有数字
cat file | tr -c '0-9' //获取文件中所有数字
cat file | tr -s ' ' // 压缩所有的空格
```


### cut按列切分文本


cut取的范围：


- N- 第N个字段到结尾
- -M 第1个字段为M
- N-M N到M个字段



cut取的单位：


- -b 以字节为单位
- -c 以字符为单位
- -f 以字段为单位（使用定界符）



```bash
cut -c 1-5 file //打印第一到5个字符
cut -c -2 file  //打印前2个字符
cut -f 3- -complement filename // 去文件除第3列的所有列
```


### paste按列拼接文本


```bash
cat file1
1
2

cat file2
colin
book

paste file1 file2
1 colin
2 book
```


默认的定界符是制表符，可以用-d指明定界符:


```bash
paste file1 file2 -d ","
1,colin
2,book
```


### wc统计行和字符的工具


```bash
wc -l file // 统计行数

wc -w file // 统计单词数

wc -c file // 统计字符数
```


### sed文本替换


首处替换：


```bash
sed 's/text/replace_text/' file   //替换每一行的第一处匹配的text
```


全局替换：


```bash
sed 's/text/replace_text/g' file

sed -i 's/text/repalce_text/g' file // 直接替换原文件
```


移除空白行：


```bash
sed '/^$/d' file
```


变量转换，已匹配的字符串通过标记&来引用：


```bash
echo this is en example | sed 's/\w+/[&]/g'
$>[this]  [is] [en] [example]
```


子串匹配标记：


```bash
# 第一个匹配的括号内容使用标记1来引用
sed 's/hello\([0-9]\)/\1/'
```


### awk数据流处理工具


awk脚本结构：


```bash
awk 'BEGIN { statements1 } {statements2} END { statements3 }'
```


工作流程：


1. 执行begin中语句块；
1. 从文件或stdin中读入一行，然后执行statements2，重复这个过程，直到文件全部被读取完毕；
1. 执行end语句块；



```bash
# 打印每一行
echo -e "line1\nline2" | awk 'BEGIN{print "start"} {print } END{ print "End" }'


# print 以逗号分割，参数以空格定界：
echo | awk ' {var1 = "v1" ; var2 = "V2"; var3="v3"; \
print var1, var2 , var3; }'
$>v1 V2 v3
```


特殊变量：


- NR:表示记录数量，在执行过程中对应当前行号
- NF:表示字段数量，在执行过程总对应当前行的字段数
- $0:这个变量包含执行过程中当前行的文本内容
- $1:第一个字段的文本内容
- $2:第二个字段的文本内容
- ...以此类推，还有第三个，第四个等等字段



```bash
# 打印每一行的第二和第三个字段
awk '{print $2, $3}' file

# 统计文件行数
awk 'END {print NR}' file

# 日志中访问次数最100的IP地址
awk '{print $1}' access.log | sort | uniq -c | sort -n -r | head -n -100

# 传递外部变量
var = 1000
echo | awk '{print vara}' vara=$var #  输入来自stdin
awk '{print vara}' vara=$var file # 输入来自文件
```


awk常用内置函数：


- index(string,search_string)：返回search_string在string中出现的位置
- sub(regex,replacement_str,string)：将正则匹配到的第一处内容替换为replacement_str
- match(regex,string)：检查正则表达式是否能够匹配字符串
- length(string)：返回字符串长度



```bash
echo | awk '{"grep root /etc/passwd" | getline cmdout; print length(cmdout) }'
```


## 磁盘管理


### 查看磁盘空间


- 查看磁盘空间利用大小
```bash
df -h
```

- -h指human，会按照M/G的单位显示利用大小，如果不加将按B为单位显示
- 查看当前目录所占空间大小
```bash
# 递归显示整个目录的大小
du -sh
```


### 打包/压缩/解包/解压缩


打包指将多个文件合并到一个文件，而解包则是逆操作，可用参数：


- -c :打包选项
- -x :解包选项
- -v :显示打包进度
- -f :使用档案文件



注意，有的系统指定参数时不需要加上-，直接使用tar xvf


```bash
tar -cvf etc.tar /etc <==仅打包，不压缩！
```


压缩：


```bash
gzip file
```


解包:


```bash
tar -xvf file.tar
```


解压缩：


```bash
# 使用gunzip
gunzip demo.tar.gz
tar -xvf  demo.tar

# 使用bz
bzip2 -d  demo.tar.bz2
tar -xvf  demo.tar
```


## 进程管理


### 查询进程


用ps查询正在进行的进程：


```bash
ps -ef

# 属于用户colin115的进程
ps -ef | grep colin115
```


或者使用lsof查看进程状态：


```bash
# 端口占用的进程状态
lsof -i:3306

# 用户username的进程所打开的文件
lsof -u username

# 指定进程ID打开的文件
lsof -p 23295

# 指定目录下被进程开启的文件
lsof +D dir/
```


补充lsof的所有参数：


- -a 列出打开文件存在的进程
- -c<进程名> 列出指定进程所打开的文件
- -g 列出GID号进程详情
- -d<文件号> 列出占用该文件号的进程
- +d<目录> 列出目录下被打开的文件
- +D<目录> 递归列出目录下被打开的文件
- -n<目录> 列出使用NFS的文件
- -i<条件> 列出符合条件的进程。（4、6、协议、:端口、 @ip ）
- -p<进程号> 列出指定进程号所打开的文件
- -u 列出UID号进程详情
- -h 显示帮助信息
- -v 显示版本信息



### 终止进程


杀死指定PID的进程


```bash
kill [PID]
```


杀死指定job


```bash
kill [job num]
```


### 进程监控


输入top命令后，进入到交互界面；接着输入字符命令后显示相应的进程状态，查看系统中使用CPU、使用内存最多的进程。


```bash
$top
(->)P
```


对于进程，平时我们最常想知道的就是哪些进程占用CPU最多，占用内存最多。以下参数就可以满足要求:


- P：根据CPU使用百分比大小进行排序
- M：根据驻留内存大小进行排序
- i：使top不显示任何闲置或者僵死进程



### 分析线程栈


使用命令pmap，来输出进程内存的状况，可以用来分析线程堆栈；


```bash
$pmap PID

eg:
[/home/weber#]ps -fe| grep redis
weber    13508 13070  0 08:14 pts/0    00:00:00 grep --color=auto redis
weber    29515     1  0  2013 ?        02:55:59 ./redis-server redis.conf
[/home/weber#]pmap 29515
29515:   ./redis-server redis.conf
08048000    768K r-x--  /home/weber/soft/redis-2.6.16/src/redis-server
08108000      4K r----  /home/weber/soft/redis-2.6.16/src/redis-server
08109000     12K rw---  /home/weber/soft/redis-2.6.16/src/redis-server
```


## 性能监控


### 监控CPU


查看CPU使用率：


```bash
sar -u

# 每秒采样一次，总共采样两次
sar -u 1 2

# 查看CPU平均负载，包括运行队列中的进程数、系统上的进程大小、平均负载等
```


### 查询内存


查看内存使用状况


```bash
sar -r 1 2
```


查看内存使用量


```bash
free -m
```


### 查看页面交换


```bash
sar -W
```


### 替代品


当系统中sar不可用时，可以使用以下工具替代：linux下有 vmstat、Unix系统有prstat


eg： 查看cpu、内存、使用情况： vmstat n m （n 为监控频率、m为监控次数）


```bash
[/home/weber#]vmstat 1 3
procs -----------memory---------- ---swap-- -----io---- -system-- ----cpu----
r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa
0  0  86560  42300   9752  63556    0    1     1     1    0    0  0  0 99  0
1  0  86560  39936   9764  63544    0    0     0    52   66   95  5  0 95  0
0  0  86560  42168   9772  63556    0    0     0    20  127  231 13  2 84  0
```


## 网络工具


### 查询网络服务和端口


netstat命令用于显示各种网络相关信息，如网络连接，路由表，接口状态(Interface Statistics)，masquerade连接，多播成员(Multicast Memberships)等等。


```bash
# 列出所有端口 (包括监听和未监听的):
netstat -a

# 列出所有 tcp 端口:
netstat -at

# 列出所有有监听的服务状态:
netstat -l
```


查询7902端口正在运行什么程序：


```bash
#第一步，查询使用该端口的进程的PID；
    $lsof -i:7902
    COMMAND   PID   USER   FD   TYPE    DEVICE SIZE NODE NAME
    WSL     30294 tuapp    4u  IPv4 447684086       TCP 10.6.50.37:tnos-dp (LISTEN)

#查到30294
#使用ps工具或lsof查询进程详情：
$ps -fe | grep 30294
或 lsof -p 30294

tdev5  30294 26160  0 Sep10 ?        01:10:50 tdesl -k 43476
root     22781 22698  0 00:54 pts/20   00:00:00 grep 11554
```


### 网络路由


查看路由状态：


```bash
route -n
```


探测IP地址：


```bash
# 发送Ping包
ping IP

# 探测路由
traceroute IP
```


DNS查询：


```bash
# 寻找域名domain对应的IP
host domain 

# 反向DNS查询
```


### 镜像下载


下载文件或者网页：


```bash
wget url
```


参数：


- –limit-rate :下载限速
- -o：指定日志文件；输出都写入日志；
- -c：断点续传



### ftp sftp lftp ssh


ssh登陆远程服务器host，ID为用户名：


```bash
$ssh ID@host
```


ftp/sftp登陆服务器host，ID为用户名：


```bash
$sftp ID@host
```


sftp登陆后，可以使用下面的命令进一步操作：


```bash
get filename # 下载文件
put filename # 上传文件
ls # 列出host上当前路径的所有文件
cd # 在host上更改当前路径
lls # 列出本地主机上当前路径的所有文件
lcd # 在本地主机更改当前路径
```


lftp同步文件夹(类似rsync工具):


```bash
lftp -u user:pass host
lftp user@host:~> mirror -n
```


### 网络复制


将本地localpath指向的文件上传到远程主机的path路径:


```bash
$scp localpath ID@host:path
```


以ssh协议，遍历下载path路径下的整个文件系统，到本地的localpath:


```bash
$scp -r ID@site:path localpath
```


## 用户管理


### 用户添加删除切换


为用户创建相应的帐号和用户目录/home/username，并设置密码：


```bash
$useradd -m username
$passwd username
```


删除用户，注意不带选项使用 userdel，只会删除用户，用户的家目录将仍会在/home目录下。要完全的删除用户信息，使用-r选项；


```bash
$userdel -r username
```


登录帐号为userA用户状态下，切换到userB用户帐号工作:


```bash
$su userB
```


### 用户组


默认情况下，添加用户操作也会相应的增加一个同名的组，用户属于同名组； 查看当前用户所属的组:


```bash
groups
```


一个用户可以属于多个组，将用户加入到组:


```bash
$usermod -G groupNmame username
```


变更用户所属的根组(将用加入到新的组，并从原有的组中除去）:


```bash
$usermod -g groupName username
```


查看所有用户 & 用户组及权限:


```bash
$more /etc/passwd
$more /etc/group
```


### 用户权限


使用ls -l可查看文件的属性字段，文件属性字段总共有10个字母组成，第一个字母表示文件类型，如果这个字母是一个减号”-”,则说明该文件是一个普通文件。字母”d”表示该文件是一个目录，字母”d”,是dirtectory(目录)的缩写。 后面的9个字母为该文件的权限标识，3个为一组，分别表示文件所属用户、用户所在组、其它用户的读写和执行权限； 例如:


```bash
[/home/weber#]ls -l /etc/group
-rwxrw-r-- colin king 725 2013-11-12 15:37 /home/colin/a
```


使用chmod命令更改文件的读写权限，更改读写权限有两种方法，一种是字母方式，一种是数字方式


字母方式:


```bash
$chmod userMark(+|-)PermissionsMark
```


userMark取值：


- u：用户
- g：组
- o：其它用户
- a：所有用户



PermissionsMark取值：


- r：读
- w：写
- x：执行



数字方式：


数字方式直接设置所有权限，相比字母方式，更加简洁方便。


使用三位八进制数字的形式来表示权限，第一位指定属主的权限，第二位指定组权限，第三位指定其他用户的权限，每位通过4(读)、2(写)、1(执行)三种数值的和来确定权限。如6(4+2)代表有读写权，7(4+2+1)有读、写和执行的权限。


```bash
$chmod 740 main     将main的用户权限设置为rwxr-----
```


### 环境变量


bashrc与profile都用于保存用户的环境信息，bashrc用于交互式non-loginshell，而profile用于交互式login shell。


/etc/profile，/etc/bashrc 是系统全局环境变量设定
/.bashrc用户目录下的私有环境变量设定


当登入系统获得一个shell进程时，其读取环境设置脚本分为三步:


1. 读入的是全局环境变量设置文件/etc/profile，然后根据其内容读取额外的文档，如/etc/profile.d和/etc/inputrc
1. 读取当前登录用户Home目录下的文件/.bash_login，最后读取~/.profile，这三个文档设定基本上是一样的，读取有优先关系
1. 读取~/.bashrc



## 系统管理与IPC资源管理


### 系统管理


基本软硬件查询：


```bash
# 系统版本
$uname -a

# CPU信息
$cat /proc/cpuinfo

# 内存信息
$cat /proc/meminfo

# 内存页大小
$pagesize

# 架构
$arch
```


系统时间设置：


```bash
$date -s 2014-09-15 17:05:00
$date -s 2014-09-15
$date -s 17:05:00

# 强制把时间写入CMOS
clock -w
```


### IPC资源管理


查看系统使用的IPC资源:


```bash
------ Shared Memory Segments --------
key        shmid      owner      perms      bytes      nattch     status

------ Semaphore Arrays --------
key        semid      owner      perms      nsems
0x00000000 229376     weber      600        1

------ Message Queues --------
key        msqid      owner      perms      used-bytes   messages
```


参数：


- -m：查看系统使用的IPC共享内存资源
- -q：查看系统使用的IPC队列资源
- -s：查看系统使用的信号量资源



显示当前所有的系统资源limit 信息:


```bash
ulimit – a
```
