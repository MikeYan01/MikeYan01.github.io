---
title: MongoDB
tags: Notes Computer-Science Databases
article_header:
  type: 
  image:
    src: 
---

MongoDB Notes

<!--more-->

## 简介


MongoDB是由C++语言编写的，是一个基于分布式文件存储的开源数据库系统。MongoDB旨在为WEB应用提供可扩展的高性能数据存储解决方案。


## 结构


MongoDB将数据存储为一个文档，数据结构由键值(key=>value)对组成，每个MongoDB文档类似于JSON对象。字段值可以包含其他文档，数组及文档数组。


一组文档构成一个集合。如果说MongoDB中的文档类似于关系型数据库中的行，那么集合就如同表。


每一个文档都有一个特殊的键"_id",它在文档所处的集合中是唯一的，相当于关系数据库中的表的主键。


## 分片


分片（sharding）是指将数据库拆分，将其分散在不同的机器上的过程。将数据分散到不同的机器上，不需要功能强大的服务器就可以存储更多的数据和处理更大的负载。基本思想就是将集合切成小块，这些块分散到若干片里，每个片只负责总数据的一部分，最后通过一个均衡器来对各个分片进行均衡（数据迁移）。


使用时机：


- 机器的磁盘不够用了。使用分片解决磁盘空间的问题
- 单个mongod已经不能满足写数据的性能要求。通过分片让写压力分散到各个分片上面，使用分片服务器自身的资源
- 想把大量数据放到内存里提高性能。和上面一样，通过分片使用分片服务器自身的资源



分片架构图：

![shard.png](https://raw.githubusercontent.com/MikeYan01/mikeyan01.github.io/master/assets/images/Databases/shard.png)

Mongos本身并不持久化数据，Sharded cluster所有的元数据都会存储到Config Server
而用户的数据则会分散存储到各个shard。Mongos启动后，会从config server加载元数据，开始提供服务，将用户的请求正确路由到对应的Shard。


## 优缺点


优点：


- 面向集合存储，易于存储对象类型的数据
- 动态查询：支持丰富的查询表达式，查询指令使用JSON形式的标记，可轻易查询文档中内嵌的对象及数组
- 完整的索引支持：包括文档内嵌对象及数组，不需要定义任何模式，极大的提高查询的效率
- 自动分片以支持云级别的伸缩性：当MongoDB存储海量的数据时，一台机器可能不足以存储数据，也可能不足以提供可接受的读写吞吐量。这时，我们就可以通过在多台机器上分割数据，使得数据库系统能存储和处理更多的数据
- 查询监视：MongoDB的查询优化器会分析查询表达式，并生成一个高效的查询计划；并且有explain()，hint()这样的工具函数用于性能分析，判断索引是否正确工作等
- 复制及自动故障转移：支持服务器之间的数据复制，支持主-从模式及服务器之间的相互复制。复制的主要目标是提供冗余及自动故障转移
- 支持JavaScript语法的map-reduce，对于大规模数据分析、处理相当实用
- 内置GridFS模块，这是一个出色的分布式文件系统，可以支持大容量数据存储
- 4.0版本后已经支持了事务管理，弥补了以往的最大不足



缺点：


- 内存占用很大，因为其使用B树作索引，所有节点都有Data域，只要找到指定索引就可以进行访问，保证单次查询的效率。然而缺点是B树中，索引和数据都需要内存来存，因此开销很大
- 表单关系设计过于自由，必须在项目前期有很好的规划，否则开发时容易出现错误，后期不好维护
- 仍然不适用要求高度事务性的场景，例如金融、会计系统等
- 删除记录不释放空间：为避免记录删除后的数据大规模挪动，原记录空间不删除并回收，只标记已删除即可，以后还可以重复利用。这导致mongoDB对硬盘空间的消耗也比较大
